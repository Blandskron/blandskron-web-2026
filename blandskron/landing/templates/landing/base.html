{# landing/templates/landing/base.html #}
{% load static %}
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blandskron</title>

  <!-- Google Font: Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    rel="stylesheet"
  >

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="{% static 'landing/css/site.css' %}" />
</head>

<body class="bg-[#0f0f0f] text-white overflow-x-hidden">

  {% include "landing/partials/_floating.html" %}
  {% include "landing/partials/_header.html" %}

  <!-- Flash messages -->
  <div class="fixed top-20 left-1/2 -translate-x-1/2 z-[999] w-[92%] max-w-xl space-y-2">
    {% for message in messages %}
      <div class="rounded-xl border border-white/10 bg-white/10 backdrop-blur px-4 py-3 text-sm">
        {{ message }}
      </div>
    {% endfor %}
  </div>

  {% block content %}{% endblock %}

  <script>
    // Smooth scroll
    document.addEventListener("click", (e) => {
      const btn = e.target.closest("[data-scroll]");
      if (!btn) return;

      const id = btn.getAttribute("data-scroll");
      const el = document.getElementById(id);
      if (!el) return;

      // Close mobile menu if open
      const mobileMenu = document.getElementById("mobileMenu");
      const mobileBtn = document.getElementById("mobileMenuBtn");
      if (mobileMenu && mobileBtn && !mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.add("hidden");
        mobileBtn.setAttribute("aria-expanded", "false");
      }

      el.scrollIntoView({ behavior: "smooth", block: "start" });
    });

    // Mobile menu toggle
    (function () {
      const btn = document.getElementById("mobileMenuBtn");
      const menu = document.getElementById("mobileMenu");
      if (!btn || !menu) return;

      btn.addEventListener("click", () => {
        const isHidden = menu.classList.contains("hidden");
        menu.classList.toggle("hidden");
        btn.setAttribute("aria-expanded", String(isHidden));
      });

      // Close on resize to desktop
      window.addEventListener("resize", () => {
        if (window.innerWidth >= 768) {
          menu.classList.add("hidden");
          btn.setAttribute("aria-expanded", "false");
        }
      });
    })();

    // Active link highlight (IntersectionObserver)
    (function () {
      const sections = ["home","about","services","certifications","contact"]
        .map(id => document.getElementById(id))
        .filter(Boolean);

      const links = Array.from(document.querySelectorAll(".nav-link"));

      function setActive(id) {
        links.forEach((el) => {
          const target = el.getAttribute("data-scroll");
          if (target === id) el.classList.add("is-active");
          else el.classList.remove("is-active");
        });
      }

      if (!("IntersectionObserver" in window) || sections.length === 0) return;

      const obs = new IntersectionObserver((entries) => {
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (visible?.target?.id) setActive(visible.target.id);
      }, { root: null, threshold: [0.2, 0.35, 0.5, 0.65] });

      sections.forEach(s => obs.observe(s));
    })();
  </script>
</body>
</html>
